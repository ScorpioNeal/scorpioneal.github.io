<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">

<script data-ad-client="ca-pub-3610947468348159" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="AndroidActivity,">










<meta name="description" content="http://blog.csdn.net/qian520ao/article/details/78156214 https://juejin.im/post/59aba2a6f265da248e75883c https://juejin.im/post/5c3832e66fb9a049e308510b App启动过程存在4个进程, Launcher进程，system_server进程, Zygot">
<meta name="keywords" content="AndroidActivity">
<meta property="og:type" content="article">
<meta property="og:title" content="Android App启动过程和Activity启动过程">
<meta property="og:url" content="http://www.scions.cn/posts/b5608f0f/index.html">
<meta property="og:site_name" content="ScorpioNeal&#39;s Blog">
<meta property="og:description" content="http://blog.csdn.net/qian520ao/article/details/78156214 https://juejin.im/post/59aba2a6f265da248e75883c https://juejin.im/post/5c3832e66fb9a049e308510b App启动过程存在4个进程, Launcher进程，system_server进程, Zygot">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ceffcc21-00bf-41d9-8b3b-87453caf8403/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45M6JA72MA%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T012707Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCSAOw19aEBzxv7f%2BlWzRpU0CDWhA4iBXVRZNo1fVautwIhANOy8IOoYqLE%2Fnk6uUEjOLZa4XCa13OtLuM0nCPBhH%2FPKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgxGM9ZBs48YByFE6y8qkQNqki8NOz3IAGhvOQNwlQura1J12AcDGdc4v8dWpHvuDNvlXF%2FKoBWNR7a4rYxpVwpu3t70Ff4Wo1kB0jRbchLTsdGZi8lZrYbdlr95VdlIhPmJWN2YT441WV5u4GQede0gPwszhvDuoiptrW%2Ftdj0sBL6ynCBir1D0aQibsh6cIysAlcNmUyEcW%2BMU7RapDvGNQ5A1tG2yGT%2FEwM7MJgXykNeediBx2l2eE7YhK6uSF52vKiYc3h5L01ea%2BY13PbLIF5pojgddEm2PKi96zExPwjGMIuuceG10z54T6ZdCeip62N5OF4CYSxbRfoMVn%2FA3tCS3w3Gkqb943WeYzQJzdV%2BGEvOY1CDwfyGj21joxp5%2B7tSVnxpCZtlOSC85RCg7DAuO%2FQgA6EvowtW9U0RvxH3iPm4HDKJLIj3GXUAcat4pOV%2BROLs8EDeB4qKVd3zy%2BCwxn%2BloMGS%2BqoLj%2FlnAHEuPGxq3oF7iwz99ni6sJKdd7NWwGgjr8SL4SXtb7SsGYOoy1vYQaw4zrbyj71Be2DC46vjwBTrqAcmiIGa3UYYFklL1OAHcKJxHhq%2Fg%2FGRtowD2MBH4Cjsi%2Fnm8o2yf3tECPMMDU4ih5hKzoEgVSgI4sqe%2FEc1TMFwcGFgBrHGHC1rktpTbOEP4F3sNOEVuv%2By8Ymipw%2FWgr4iwG72iPKD3zyXMUS%2Fs%2FSXDafGCAg5wvfozQhmR0I7RN1%2FnuZBWQ59ExfO5ny3X%2B5s5HUi42VgPCF%2BLpMP4bskBTtS%2Fg1%2F2PS8yqqtWGc5ZHboaCTPq9iaePqbIpyCicDGXKl0i5H8H1q42O6HwIhWNnYJGNVo%2BhCUdYTa5umGznXPWGdYZrBYr0Q%3D%3D&X-Amz-Signature=ce82de06c8a85823d849e49346b1ec55a415d52c8f7ea1f89278df5b024df9ec&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22">
<meta property="og:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ec048d04-cf9b-4245-817e-3faa8a0bfd1c/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45NXGUY7N7%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T012729Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCvOuYx87EWSqLUCowf2%2BSESKoTeprBtz7OBO1mTiIDmAIhANkXmYli%2F3nCrYpt6CFu7hm1U2zjYnHl%2Bv7KaeOyXsjWKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgwHGW5EjaiBv0ow4S8qkQNqQaxkPJ%2BJXb2nJwnFl5xFzpgxqgOhzCLFdnhZMaQPkDvuVLrQDPsfOGRZAqUYaigpqp%2Bs4W6h%2BPjrfWbi5FTf1La49jjEmAQ75LTyPj4wY4E1dkZw3I9ymObRszCuFGXWWlSFrL9A3bNBX1V%2FtQn6ppDjeCbEBDAD%2Fh9UVNeZY0ldjT4RLuVKabYtoCI52rd3rWQJG7PgTjvznhAVixm%2BJmbVk6%2Bv%2BOLp7ZAHkaN1v3uuYFiZc0QxZwr9WABrNnzgvDGYByfIYxkMXc4cXW6MlLDpCpcX2v77cjk4lgu74c93BgwwHHwKVCen%2BiW%2FUVD4dSyBPp8vrfXFMXAyIQzQwpoK1nrGdBlNjp9GYRX%2BFPKENj2HyZMrY8qekc0nUB3I39I7gETKDBG6%2FlE3HlQCX0Gf3LE2YYZ57vnHdCaTjpdNfy%2FK9kpT8MuCZKY7x6ax5eNIti2czGI0qr43HVQNz%2BVEKZRow940tBwT8xsnt3sy1NGa6VSpnsQLYbSnZOcenCW5dPk3eKCHjFsL%2BXAKDDDz5vjwBTrqAfVKvDZUbDt1lnqiBI%2BQhyhXn2BMTiLfYHebuVM5ZV%2B9jxKDkUd9g7jA9IH5ALSKNiZLkua0taZ5PYjj9f1503%2BlsOVD28GzkOhXgdAlzWKRZ2gD4yzK73V9pglxf%2F0q0vjzefEf8VaEMD8sMa3GNOUzZFuhoS8WjUp9mp3ogO8pEZHQcPZwA5MSVTz7ju%2FXKYD7xygFy59cuZXNKuzPsCXW0lz3xQIatj%2FNnKyUqpKXQ8Ssmx4V0bup3t7KSAIwGDO%2F8QcWlRz%2BPqMajcBfMDlQJfzfX7ndyDFtJIIF%2FzpipyqB%2BiTNZBU4tg%3D%3D&X-Amz-Signature=0ab98984a39751e2d7a4bee79a639bda6cba399b8bb47866959c7bcc2f03a9c8&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22">
<meta property="og:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/c27a8e9f-547a-4932-a3ec-7609ad1a8dd9/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45BGMYQT6J%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T020052Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCrlLN7wsv%2BTC1H3UhT2BWXLEbIFu84YlFPSEULO8tGbAIgJw5hAh%2BmD9q8CF1q0dUBYYmy7fLGybiFXUaNVp%2BvTCkqtAMIZhAAGgwyNzQ1NjcxNDkzNzAiDGzyGx4ScYOs4BsygCqRAzSxMViZG1aYRupqqXqwsehKxhOzJ1cIPF2pVUBCzxG4GY3Za2q98YdxXRf0aygK33EHCbPDjETBi%2Ff1eYRQwAqy6DgRS2l9Na5PbuGhUpGZjh08R01AkpFpTqvR%2FKikfu95U%2BXG1has3Xlcg1w5B33Doo%2FJ0Ca8dyPysePbsocyzNz2FyQvCCR%2Fv5AHfsBd4znRjcl%2B4fXUp%2F4eyV56aPlehcGGs1diCgajGQ6PCUnWqbJo9opdHHgCA8mgfx0u9A%2FqAZWJBxGVwtJK9oOMVXzntiREOCpTiANHqRn%2B8hM3Yy3SyI0M64cJzp%2FF%2BIwhyYymQDlcb%2Bo189YvDMoy8I5h9a%2FUrFgGouoLvh2OP12FdCfJna8zOsmc6UdLAPR9xiAWPab52U0zRzcrEiRx%2B0mRkJ9aabwz5kBiNluK4zIzkGUpJaFx4veso1BvYwomz1VIsbnNMbdA4vxrd5eSlQFzBd815W3jG7aOvkw1iF%2Boa2RL9%2BZM9bDRKiMn7IPLccZTMGH0Jq8AlLsxWZ9qWz4CMNjR%2BPAFOusBI026Ni36%2B6ttH9x1r8%2FqzqZj%2Fd4emkhfJVH5zz2n5AOs2hTLWzNFLbHPfEmhc3W3zjuBqzh6YUf7brdvomFBVhGwK54MCSuP1PRe8jv8sIzTZgGQBTHFxzstTEyNB7T%2FuGwfyZedjjZBayBE4DY4cwEohKi5e%2BVFBMCKuabPKNhwWXsUUkchj3OQESh%2BDwqm75e3dbJAY71oI9GIAg%2F0LIVbhiidOasztq8OA34Zf20xmgdybl28sJQ28%2F5ujHW%2FMc%2BOJzqO66Oy4H7UKNMQEzMpALMNI7P7VFLZIG17aq0LEQ%2BWRpBAwk5WtQ%3D%3D&X-Amz-Signature=297f114c8203811b5b82c8d3456a66730952383c322a493ed346df610b634452&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22">
<meta property="og:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/eae3a6be-0576-4b97-ad77-a7b545e9d38d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45ABCNKXHH%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T020040Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD%2FHuUjg5gr8C7Ed13a4i1kJx6kZ5qxZMvnUPp5LlianwIhAJx4ni%2FL8n3AwZ7127oG8PSgHAPZ4WmQHNL%2FnbFxZOfnKrQDCGYQABoMMjc0NTY3MTQ5MzcwIgyYenibqLwYVL87r6IqkQOvsGK7n9vUVFwwatyrD2Qt3gyVB%2B2L3QFZPQzIexEz5YgDjKK0RYL0VmWKidxZqjUTwA4u275MgT1Mu9ZY2XGxD6er6X6QSeGUL%2BwcJPT8r0SaHPf3hmQsAL3o7w5v4UIND9NNpTwwGodMvqpDJn%2FgVExFYsig3Ol7Q3OPi2K3%2Bnp2KyQzwsacBoB%2Bs5KGvsRTQ3Ajb%2FWfQw5FRYOMrYc9Qa4Fag%2BeVjHtkBs9YdiFPXnc6d4VB4blHi6D9fWhzytljnrB1PiwviOmHPLSgVB2kHz1B%2BsnqVhc0uvFr4uV6Te7BF2rI%2FvonJzEYD6KmNV0pBnhDLsCxHUkRdIVTpmHRe%2FvdLYicmdk4UuERI7ypL1o2Aa5m2X4jG0hqYJDDYBT18SiVtz56MWzXlZN0qI2Wi3NtBr%2FHtqlevEbKLh8kZyco5x0ds1MBf4KoZWU9rYUhWEiplLZK0%2Fg0OYuygqmXn6YIeJRtuHzsriiomDpP4gqf1lJbehN5Sw9c2u%2F4Hc1y%2BqdClYhvUwlCSUlTbb%2BxTDy2vjwBTrqAZrstycL0LbjMiXqUGpuvlCAVxf8aDIqg5Ea6964D68HFl9Rqdivvv%2BxOhdoTN0b1v0g8uiDwUgw82pN3F3xJzE9VprK9rVw4KUIPw8xjqhbWVvrSjYV5NVc5clWKCDKE3mEkpgt5LAGrFTUkdmAHsS098AOQhvkF5Y%2BYZgkLIIlIzFAEa8UkVVmCwU%2FulzgNRAiLAvUtScW68HS1A%2BTp4YWXcvAQMU4h%2BINO5SKg1k2hgoU%2Fb8NPa6ofU6IFvJ5uwk3XPspesDedi86HlCTs1fLW%2BS%2F27UODic9Lhvn9Vta2lAa9Xpsn6OKnA%3D%3D&X-Amz-Signature=2a45fb6aa493dc656c9d912a578476c768730500e68f6eb89950a669e0eea725&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22">
<meta property="og:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/a604c5b5-b967-4759-8527-dba82b60032a/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45CVDBZQGM%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T020029Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCPFUQ9eVBhVG%2FxqjNRO11arCOihCaAOE%2FIvHjyGqhw1wIhAKBFpsEOpIXmHAx8hyq5YW5hdQq30S%2F34MeIzr5%2BsNlZKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgwkBRVtA6z13TC4Q7MqkQNgsIkQD3FmJggamt3NXPLMPqH9jRLatDGTtop1ay9WbPSTgBcYKFIjehnCQdkHleEAj6Q0HglEifrQHM3lSWUjwPfc6GJr%2BKfiZvefyoa3fipuPspQ%2BV9PGuwTC8HX9he3sFuFl%2BL3If3G1JpssuyPsnXQLCyIJAhI1gajARFR34zIeiVZOq4rXsQpr5jd7mkxbDvOxog81t8JD8IIhmXhYOmYwBuP3aG7B1HH6%2FgkJVRD69yln1MN2HYcn6wbDElEoKxqri5Om4YSbt6J9vHlVIQpRkjGCO5AG%2BB%2BKjEQqnS%2F93YIv1h%2FB7SIAwpNCAop6cz4TXsR59aT4den7Sr0GUhUK26Ofx8EPbCb33NiaWNZqBJYU47jV%2FT6CUAOV4V8BHRcHk%2BuWBQ91UTVWEeeqAphJQsDS8byl%2BV%2BLw9gz%2F0y3yO99zTVhMI4QTgcNKdYIdBjOc2NyMimJ2dqTcBNdTg1zWS0%2FM%2FtttWejbOLLxVM%2BYJAyFvInzUiruH87zCpNGN16F70PW1vTHBnNg9p7zCM5fjwBTrqAaSNk4ugdnmFqEEAoCokJlJyP28l078BGYTwI9mte7tTbKZImR6gEeBxV0R6i545NGTPXsF3RbzuJZQdQl9WkJrAVbQ5FE6I6GEslT%2FNzH%2BKTqllG98naywEH92CZNvhrPfas2SjhSZeCz5i4Ng71uSB6hNrIZwBVlxohMVGl564UhUJS5b%2F0H7PxerJ8lU10Ze%2BvCL0PyBPq%2Ftqg6ebM61TJ1HH9ZreFba2x84qxFbCut%2FleuxJtCa8rerOZhqdSQ7GcX9a3d%2FZcZxaxLt2H%2BF6dWtvE%2BKZsrLZoHTlKt9Eew8e8Fyak2tEOA%3D%3D&X-Amz-Signature=42f5fcf4aac3359a7b8bf3b227620b0b3eaf4f47d1e57311004782dea8469e7d&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22">
<meta property="og:updated_time" content="2020-01-15T02:00:59.248Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android App启动过程和Activity启动过程">
<meta name="twitter:description" content="http://blog.csdn.net/qian520ao/article/details/78156214 https://juejin.im/post/59aba2a6f265da248e75883c https://juejin.im/post/5c3832e66fb9a049e308510b App启动过程存在4个进程, Launcher进程，system_server进程, Zygot">
<meta name="twitter:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ceffcc21-00bf-41d9-8b3b-87453caf8403/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45M6JA72MA%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T012707Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCSAOw19aEBzxv7f%2BlWzRpU0CDWhA4iBXVRZNo1fVautwIhANOy8IOoYqLE%2Fnk6uUEjOLZa4XCa13OtLuM0nCPBhH%2FPKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgxGM9ZBs48YByFE6y8qkQNqki8NOz3IAGhvOQNwlQura1J12AcDGdc4v8dWpHvuDNvlXF%2FKoBWNR7a4rYxpVwpu3t70Ff4Wo1kB0jRbchLTsdGZi8lZrYbdlr95VdlIhPmJWN2YT441WV5u4GQede0gPwszhvDuoiptrW%2Ftdj0sBL6ynCBir1D0aQibsh6cIysAlcNmUyEcW%2BMU7RapDvGNQ5A1tG2yGT%2FEwM7MJgXykNeediBx2l2eE7YhK6uSF52vKiYc3h5L01ea%2BY13PbLIF5pojgddEm2PKi96zExPwjGMIuuceG10z54T6ZdCeip62N5OF4CYSxbRfoMVn%2FA3tCS3w3Gkqb943WeYzQJzdV%2BGEvOY1CDwfyGj21joxp5%2B7tSVnxpCZtlOSC85RCg7DAuO%2FQgA6EvowtW9U0RvxH3iPm4HDKJLIj3GXUAcat4pOV%2BROLs8EDeB4qKVd3zy%2BCwxn%2BloMGS%2BqoLj%2FlnAHEuPGxq3oF7iwz99ni6sJKdd7NWwGgjr8SL4SXtb7SsGYOoy1vYQaw4zrbyj71Be2DC46vjwBTrqAcmiIGa3UYYFklL1OAHcKJxHhq%2Fg%2FGRtowD2MBH4Cjsi%2Fnm8o2yf3tECPMMDU4ih5hKzoEgVSgI4sqe%2FEc1TMFwcGFgBrHGHC1rktpTbOEP4F3sNOEVuv%2By8Ymipw%2FWgr4iwG72iPKD3zyXMUS%2Fs%2FSXDafGCAg5wvfozQhmR0I7RN1%2FnuZBWQ59ExfO5ny3X%2B5s5HUi42VgPCF%2BLpMP4bskBTtS%2Fg1%2F2PS8yqqtWGc5ZHboaCTPq9iaePqbIpyCicDGXKl0i5H8H1q42O6HwIhWNnYJGNVo%2BhCUdYTa5umGznXPWGdYZrBYr0Q%3D%3D&X-Amz-Signature=ce82de06c8a85823d849e49346b1ec55a415d52c8f7ea1f89278df5b024df9ec&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.scions.cn/posts/b5608f0f/">





  <title>Android App启动过程和Activity启动过程 | ScorpioNeal's Blog</title>
  








  <link rel="stylesheet" href="/live2d/css/live2d.css">
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">
<div class="bg_content">
<canvas id="canvas"></canvas>
</div>
  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ScorpioNeal's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-todo">
          <a href="/todo/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            todo
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.scions.cn/posts/b5608f0f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ScorpioNeal">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ScorpioNeal's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android App启动过程和Activity启动过程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-01T23:39:34+08:00">
                2019-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/b5608f0f/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/posts/b5608f0f/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="http://blog.csdn.net/qian520ao/article/details/78156214" target="_blank" rel="noopener">http://blog.csdn.net/qian520ao/article/details/78156214</a></p>
<p><a href="https://juejin.im/post/59aba2a6f265da248e75883c" target="_blank" rel="noopener">https://juejin.im/post/59aba2a6f265da248e75883c</a></p>
<p><a href="https://juejin.im/post/5c3832e66fb9a049e308510b" target="_blank" rel="noopener">https://juejin.im/post/5c3832e66fb9a049e308510b</a></p>
<h2 id="App启动过程"><a href="#App启动过程" class="headerlink" title="App启动过程"></a>App启动过程</h2><p>存在4个进程, <code>Launcher进程</code>，<code>system_server进程</code>, <code>Zygote进程</code>, <code>App进程</code>。</p>
<ol>
<li>点击Launcher的app图标, <code>Launcher进程</code>采用<code>Binder IPC</code>向<code>system_server进程</code>发起<code>startActivity</code>请求</li>
<li><code>system_server进程</code>收到请求后, 通过Socket方式向<code>Zygote进程</code>发送创建进程的请求</li>
<li><code>Zygote进程</code>fork出新的子进程, 也就是<code>App进程</code></li>
<li><code>App进程</code>通过<code>Binder IPC</code>向<code>system_server进程</code>发起<code>attachApplication</code>请求(App端的<code>ActivityManagerProxy</code>和<code>system_server</code>端的<code>ActivityManagerService</code>通信)</li>
<li><code>system_server进程</code>收到请求后, 进行准备工作后，使用<code>ApplicationThreadProxy</code>通过<code>Binder IPC</code>向<code>App进程</code>的<code>ApplicationThread</code>发送<code>scheduleLaunchActivity</code>请求</li>
<li><code>App进程</code>的<code>ApplicationThread</code>收到请求后通过Handler向<code>ActivityThread</code>也就是主线程发送LAUNCH_ACTIVITY消息</li>
<li><code>ActivityThread</code>收到消息后, 通过反射创建目标Activity, 调用Activity的onCreate等方法</li>
<li>至此，App正式启动，进入Activity的生命周期</li>
</ol>
<p>一个app想启动另一个app, 先告诉system_server进程, system_server进程告诉Zygote进程来fork另一个app的进程, 这就涉及了4个进程间的通讯</p>
<h2 id="Zygote"><a href="#Zygote" class="headerlink" title="Zygote"></a>Zygote</h2><p>Linux中，所有的进程都是由init进程fork出来的。 Android系统开启新进程的方式，是通过fork第一个Zygote进程实现的。 也就是说除了第一个Zygote进程，其他进程都是Zygote的子进程。</p>
<h2 id="system-server"><a href="#system-server" class="headerlink" title="system_server"></a>system_server</h2><p>也是由Zygote进程fork出来的一个进程<br>系统中的许多服务都是在这个进程里开启的。</p>
<ul>
<li>ActivityManagerService AMS 所有的Activity的启开启，暂停，关闭都由AMS控制. 负责系统中所有Activity的生命周期</li>
<li>PackageManagerService</li>
<li>WindowManagerService</li>
</ul>
<p>一些概念:</p>
<ul>
<li>ActivityThread App的真正入口，当开启App之后, 调用main()开始工作，开启消息循环队列，与AMS配合完成管理Activity的工作</li>
<li>ApplicationThread, 用来实现ActivityManagerService与ActivityThread的交互</li>
<li>ApplicationThreadProxy, 是ApplicationThread在服务端的代理，负责与客户端的ApplicationThread通讯</li>
<li>Instrumentation, 每一个应用程序只有一个Instrumentation对象，每个Activity内部有一个对该对象的引用。ActivityThread创建Activity或暂停Activity的时候都需要Instrumentation来具体操作. startActivity实际调用的是 Instrumentation.execStartActivity(). (AMS通过ActivityThread, ActivityThread通过Instrument)来执行Activity的一些操作</li>
<li>ActivityStack Activity在AMS的栈管理</li>
<li>ActivityRecord ActivityStack的管理对象,每个 Activity在AMS对应一个ActivityRecord，也就是Activity对象在服务端的映射</li>
<li>TaskRecord, AMS抽象出来的任务的概念，记录ActivityRecord的栈，一个Task包含若干个ActivityRecord, AMS用TaskRecord来确保 Activity的启动和退出。</li>
</ul>
<p>(Client)ActivityManagerProxy -&gt; Binder IPC -&gt; ActivityManagerService(Server)<br>(Server)ApplicationThreadProxy -&gt; BinderIPC -&gt; ApplicationThread (Client)</p>
<p>首先看一下Activity的继承关系</p>
<p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ceffcc21-00bf-41d9-8b3b-87453caf8403/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45M6JA72MA%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T012707Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCSAOw19aEBzxv7f%2BlWzRpU0CDWhA4iBXVRZNo1fVautwIhANOy8IOoYqLE%2Fnk6uUEjOLZa4XCa13OtLuM0nCPBhH%2FPKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgxGM9ZBs48YByFE6y8qkQNqki8NOz3IAGhvOQNwlQura1J12AcDGdc4v8dWpHvuDNvlXF%2FKoBWNR7a4rYxpVwpu3t70Ff4Wo1kB0jRbchLTsdGZi8lZrYbdlr95VdlIhPmJWN2YT441WV5u4GQede0gPwszhvDuoiptrW%2Ftdj0sBL6ynCBir1D0aQibsh6cIysAlcNmUyEcW%2BMU7RapDvGNQ5A1tG2yGT%2FEwM7MJgXykNeediBx2l2eE7YhK6uSF52vKiYc3h5L01ea%2BY13PbLIF5pojgddEm2PKi96zExPwjGMIuuceG10z54T6ZdCeip62N5OF4CYSxbRfoMVn%2FA3tCS3w3Gkqb943WeYzQJzdV%2BGEvOY1CDwfyGj21joxp5%2B7tSVnxpCZtlOSC85RCg7DAuO%2FQgA6EvowtW9U0RvxH3iPm4HDKJLIj3GXUAcat4pOV%2BROLs8EDeB4qKVd3zy%2BCwxn%2BloMGS%2BqoLj%2FlnAHEuPGxq3oF7iwz99ni6sJKdd7NWwGgjr8SL4SXtb7SsGYOoy1vYQaw4zrbyj71Be2DC46vjwBTrqAcmiIGa3UYYFklL1OAHcKJxHhq%2Fg%2FGRtowD2MBH4Cjsi%2Fnm8o2yf3tECPMMDU4ih5hKzoEgVSgI4sqe%2FEc1TMFwcGFgBrHGHC1rktpTbOEP4F3sNOEVuv%2By8Ymipw%2FWgr4iwG72iPKD3zyXMUS%2Fs%2FSXDafGCAg5wvfozQhmR0I7RN1%2FnuZBWQ59ExfO5ny3X%2B5s5HUi42VgPCF%2BLpMP4bskBTtS%2Fg1%2F2PS8yqqtWGc5ZHboaCTPq9iaePqbIpyCicDGXKl0i5H8H1q42O6HwIhWNnYJGNVo%2BhCUdYTa5umGznXPWGdYZrBYr0Q%3D%3D&X-Amz-Signature=ce82de06c8a85823d849e49346b1ec55a415d52c8f7ea1f89278df5b024df9ec&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ceffcc21-00bf-41d9-8b3b-87453caf8403/Untitled.png"></p>
<p><a href="http://context.java" target="_blank" rel="noopener">Context.java</a> 抽象类</p>
<p><a href="http://contextimpl.java" target="_blank" rel="noopener">ContextImpl.java</a> Context的具体实现类</p>
<p>ContextWrapper Context的包装类 包装了其子类的公共属性，传入一个Context类型的 base, 调用base的方法进行使用，其实base就是传入了一个ContextImpl</p>
<pre><code>ContextWrapper.java

public class ContextWrapper {
        Context mBase;

    public ContextWrapper(Context base) {
        mBase = base;
    }
}</code></pre><p>ContextThemeWrapper: 包含了主题的ContextWrapper</p>
<p>由于Service和Application没有主题，所以继承自ContextWrapper.</p>
<p>来看startActivity方法: </p>
<ul>
<li><p>activity中自己实现了startActivity</p>
</li>
<li><p>ContextImpl实现了startActivity, Service和Application中都依赖于ContextImpl的实现</p>
<p>  Activity.java</p>
<p>  @Override<br>  public void startActivity(Intent intent, @Nullable Bundle options) {</p>
<pre><code>if (options != null) {
    startActivityForResult(intent, -1, options);
} else {
    startActivityForResult(intent, -1);
}</code></pre><p>  }</p>
<p>  public void startActivityForResult(@RequiresPermission Intent intent, int requestCode, @Nullable Bundle options) {<br>  //parent是什么？Android3.0之前使用ActivityGroup来解决嵌套的问题，3.0之后推出了Fragment，就将ActivityGroup废弃了，这里是对其的一个兼容。</p>
<pre><code>if (mParent == null) {
    options = transferSpringboardActivityOptions(options);
    Instrumentation.ActivityResult ar =
        mInstrumentation.execStartActivity(
            this, mMainThread.getApplicationThread(), mToken, this,
            intent, requestCode, options);
    if (ar != null) {
        mMainThread.sendActivityResult(
            mToken, mEmbeddedID, requestCode, ar.getResultCode(),
            ar.getResultData());
    }
    if (requestCode &gt;= 0) {
        mStartedActivity = true;
    }
    cancelInputsAndStartExitTransition(options);
} else {
    //此处省略调用parent的child方法
}</code></pre><p>  }</p>
<p>  ContextImpl.java</p>
<p>  //第一步，跳到第二步<br>  @Override<br>  public void startActivity(Intent intent) {</p>
<pre><code>warnIfCallingFromSystemProcess();
startActivity(intent, null);</code></pre><p>  }</p>
<p>  //warn函数<br>  private void warnIfCallingFromSystemProcess() {</p>
<pre><code>if (Process.myUid() == Process.SYSTEM_UID) {
    Slog.w(TAG, &quot;Calling a method in the system process without a qualified user: &quot; + Debug.getCallers(5));
}</code></pre><p>  }</p>
<p>  //第二步，真正实现<br>  @Override<br>  public void startActivity(Intent intent, Bundle options) {</p>
<pre><code>warnIfCallingFromSystemProcess();
if ((intent.getFlags()&amp;Intent.FLAG_ACTIVITY_NEW_TASK) == 0
        &amp;&amp; options != null 
        &amp;&amp; ActivityOptions.fromBundle(options).getLaunchTaskId() == -1) {
    throw new AndroidRuntimeException(
            &quot;Calling startActivity() from outside of an Activity &quot;
            + &quot; context requires the FLAG_ACTIVITY_NEW_TASK flag.&quot;
            + &quot; Is this really what you want?&quot;);
}
mMainThread.getInstrumentation().execStartActivity(
        getOuterContext(), mMainThread.getApplicationThread(), null,
        (Activity) null, intent, -1, options);</code></pre><p>  }</p>
</li>
</ul>
<p>这里都是通过Instrumentation通过执行execStartActivity来实现。</p>
<pre><code>public ActivityResult execStartActivity(
            Context who, IBinder contextThread, IBinder token, Activity target,
            Intent intent, int requestCode, Bundle options) {
    ...
    int result = ActivityManagerNative.getDefault()
        .startActivity(whoThread, who.getBasePackageName(), intent,
                intent.resolveTypeIfNeeded(who.getContentResolver()),
                token, target != null ? target.mEmbeddedID : null,
                requestCode, 0, null, options);
    // who： 正在启动该Activity的上下文
  // contextThread 正在启动该Activity的上下文线程，这里为ApplicationThread
  // token 正在启动该Activity的标识
// target 正在启动该Activity的activity, 也就是回调结果的Activity
    checkStartActivityResult(result, intent);
    ...
}</code></pre><p>这里先看下checkStartActivityResult(result, intent)这个方法, 用于根据返回码和intent抛出相应的异常</p>
<pre><code>public static void checkStartActivityResult(int res, Object intent) {
    if (res &gt;= ActivityManager.START_SUCCESS) {
        return;
    }
    switch (res) {
        case ActivityManager.START_INTENT_NOT_RESOLVED:
        case ActivityManager.START_CLASS_NOT_FOUND:
            if (intent instanceof Intent &amp;&amp; ((Intent)intent).getComponent() != null)
                throw new ActivityNotFoundException(
                        &quot;Unable to find explicit activity class &quot;
                        + ((Intent)intent).getComponent().toShortString()
                        + &quot;; have you declared this activity in your AndroidManifest.xml?&quot;);
            throw new ActivityNotFoundException(
                    &quot;No Activity found to handle &quot; + intent);
        case ActivityManager.START_PERMISSION_DENIED:
            throw new SecurityException(&quot;Not allowed to start activity &quot;
                    + intent);
        case ActivityManager.START_FORWARD_AND_REQUEST_CONFLICT:
            throw new AndroidRuntimeException(
                    &quot;FORWARD_RESULT_FLAG used while also requesting a result&quot;);
        case ActivityManager.START_NOT_ACTIVITY:
            throw new IllegalArgumentException(
                    &quot;PendingIntent is not an activity&quot;);
        case ActivityManager.START_NOT_VOICE_COMPATIBLE:
            throw new SecurityException(
                    &quot;Starting under voice control not allowed for: &quot; + intent);
        case ActivityManager.START_VOICE_NOT_ACTIVE_SESSION:
            throw new IllegalStateException(
                    &quot;Session calling startVoiceActivity does not match active session&quot;);
        case ActivityManager.START_VOICE_HIDDEN_SESSION:
            throw new IllegalStateException(
                    &quot;Cannot start voice activity on a hidden session&quot;);
        case ActivityManager.START_CANCELED:
            throw new AndroidRuntimeException(&quot;Activity could not be started for &quot;
                    + intent);
        default:
            throw new AndroidRuntimeException(&quot;Unknown error code &quot;
                    + res + &quot; when starting &quot; + intent);
    }
}</code></pre><p>在看下ActivityManagerNative.getDefault() // 在Android27变成 ActivityManager.getService()</p>
<pre><code>static public IActivityManager getDefault() {
    return gDefault.get();
}
private static final Singleton&lt;IActivityManager&gt; gDefault = new Singleton&lt;IActivityManager&gt;() {
    protected IActivityManager create() {
        IBinder b = ServiceManager.getService(&quot;activity&quot;);
        ...
        IActivityManager am = asInterface(b);
        ...
        return am;
    }
};
static public IActivityManager asInterface(IBinder obj) {
    ...
    return new ActivityManagerProxy(obj);
}

所以ActivityManagerNative.getDefault().startActivity实际是由ActivityManagerProxy调用的

ActivityManagerProxy.java

public int startActivity(IApplicationThread caller, String callingPackage, Intent intent,
            String resolvedType, IBinder resultTo, String resultWho, int requestCode,
            int startFlags, ProfilerInfo profilerInfo, Bundle options) throws RemoteException {
    Parcel data = Parcel.obtain();
    Parcel reply = Parcel.obtain();
    ...
    mRemote.transact(START_ACTIVITY_TRANSACTION, data, reply, 0);
    ...
    reply.recycle();
    data.recycle();
    return result;
}

我们的Activity相当于客户端, Service相当于服务端, 这里也是一样, 
代理类就是ActivityManagerProxy, 真正传输数据的是mRemote.transact()

第一个参数告诉服务器我们请求的方法是什么
第二个参数是传递的参数

至于为什么要跨进程通信。因为应用启动会初始化一个init进程，
init进程会产生Zygote进程，它会fork出SystemService进程, 比如AMS, WMS, PMS
而我们的应用进程也是靠AMS通信告诉Zygote进程fork出来的</code></pre><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ec048d04-cf9b-4245-817e-3faa8a0bfd1c/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45NXGUY7N7%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T012729Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCvOuYx87EWSqLUCowf2%2BSESKoTeprBtz7OBO1mTiIDmAIhANkXmYli%2F3nCrYpt6CFu7hm1U2zjYnHl%2Bv7KaeOyXsjWKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgwHGW5EjaiBv0ow4S8qkQNqQaxkPJ%2BJXb2nJwnFl5xFzpgxqgOhzCLFdnhZMaQPkDvuVLrQDPsfOGRZAqUYaigpqp%2Bs4W6h%2BPjrfWbi5FTf1La49jjEmAQ75LTyPj4wY4E1dkZw3I9ymObRszCuFGXWWlSFrL9A3bNBX1V%2FtQn6ppDjeCbEBDAD%2Fh9UVNeZY0ldjT4RLuVKabYtoCI52rd3rWQJG7PgTjvznhAVixm%2BJmbVk6%2Bv%2BOLp7ZAHkaN1v3uuYFiZc0QxZwr9WABrNnzgvDGYByfIYxkMXc4cXW6MlLDpCpcX2v77cjk4lgu74c93BgwwHHwKVCen%2BiW%2FUVD4dSyBPp8vrfXFMXAyIQzQwpoK1nrGdBlNjp9GYRX%2BFPKENj2HyZMrY8qekc0nUB3I39I7gETKDBG6%2FlE3HlQCX0Gf3LE2YYZ57vnHdCaTjpdNfy%2FK9kpT8MuCZKY7x6ax5eNIti2czGI0qr43HVQNz%2BVEKZRow940tBwT8xsnt3sy1NGa6VSpnsQLYbSnZOcenCW5dPk3eKCHjFsL%2BXAKDDDz5vjwBTrqAfVKvDZUbDt1lnqiBI%2BQhyhXn2BMTiLfYHebuVM5ZV%2B9jxKDkUd9g7jA9IH5ALSKNiZLkua0taZ5PYjj9f1503%2BlsOVD28GzkOhXgdAlzWKRZ2gD4yzK73V9pglxf%2F0q0vjzefEf8VaEMD8sMa3GNOUzZFuhoS8WjUp9mp3ogO8pEZHQcPZwA5MSVTz7ju%2FXKYD7xygFy59cuZXNKuzPsCXW0lz3xQIatj%2FNnKyUqpKXQ8Ssmx4V0bup3t7KSAIwGDO%2F8QcWlRz%2BPqMajcBfMDlQJfzfX7ndyDFtJIIF%2FzpipyqB%2BiTNZBU4tg%3D%3D&X-Amz-Signature=0ab98984a39751e2d7a4bee79a639bda6cba399b8bb47866959c7bcc2f03a9c8&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ec048d04-cf9b-4245-817e-3faa8a0bfd1c/Untitled.png"></p>
<p>在AMS中</p>
<pre><code>ActivityManagerService.java

@Override
    public final int startActivity(IApplicationThread caller, String callingPackage,
            Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,
            int startFlags, ProfilerInfo profilerInfo, Bundle bOptions) {
        return startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,
                resultWho, requestCode, startFlags, profilerInfo, bOptions,
                UserHandle.getCallingUserId());
    }

caller: 就是Instrumentation中的whoThread
callingPackage: 包名
intent: 
resolvedType: 就是AndroidManifest注册时的MIME类型
resultTo: Instrumentation中的token
resultWho: target的Id
requestCode:
startFlags: 启动标志默认0

这里直接调用startActivityAsUser()
@Override
public final int startActivityAsUser(IApplicationThread caller, String callingPackage,
        Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,
        int startFlags, ProfilerInfo profilerInfo, Bundle bOptions, int userId) {
    enforceNotIsolatedCaller(&quot;startActivity&quot;);
    userId = mUserController.handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(),userId, false, ALLOW_FULL_ONLY, &quot;startActivity&quot;, null);
    return mActivityStarter.startActivityMayWait(caller, -1, callingPackage, intent,resolvedType, null, null, resultTo, resultWho, requestCode, startFlags,profilerInfo, null, null, bOptions, false, userId, null, null);
}

通过ActivityStarter来startActivityMayWait

final int startActivityMayWait(IApplicationThread caller, int callingUid,
            String callingPackage, Intent intent, String resolvedType,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
            IBinder resultTo, String resultWho, int requestCode, int startFlags,
            ProfilerInfo profilerInfo, IActivityManager.WaitResult outResult, Configuration config,
            Bundle bOptions, boolean ignoreTargetSecurity, int userId,
            IActivityContainer iContainer, TaskRecord inTask) {
    ...
    ResolveInfo rInfo = mSupervisor.resolveIntent(intent, resolvedType, userId);
    ...
    ActivityInfo aInfo = mSupervisor.resolveActivity(intent, rInfo, startFlags, profilerInfo);
    ...
    final ProcessRecord heavy = mService.mHeavyWeightProcess;
    if (heavy != null &amp;&amp; (heavy.info.uid != aInfo.applicationInfo.uid
            || !heavy.processName.equals(aInfo.processName))) {
        ...
    }
    ...
    int res = startActivityLocked(caller, intent, ephemeralIntent, resolvedType,
            aInfo, rInfo, voiceSession, voiceInteractor,
            resultTo, resultWho, requestCode, callingPid,
            callingUid, callingPackage, realCallingPid, realCallingUid, startFlags,
            options, ignoreTargetSecurity, componentSpecified, outRecord, container,
            inTask);
    ...
}
这里的mSupervisor(ActivityStackSupervisor)简单来说就是管理ActivityStack的
resolveIntent和resolveActivity方法用来确定此次启动activity信息

关于heavy(ResolveInfo)涉及到重量级进程(SystemServer, MediaServer,ServiceManager)
，如果当前系统中已经存在的重量级进程且不是即将要启动的这个，
那么就要给Intent赋值。接下来继续走我们的探索之路startActivityLocked。


final int startActivityLocked(IApplicationThread caller, Intent intent, Intent ephemeralIntent,
            String resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
            IBinder resultTo, String resultWho, int requestCode, int callingPid, int callingUid,
            String callingPackage, int realCallingPid, int realCallingUid, int startFlags,
            ActivityOptions options, boolean ignoreTargetSecurity, boolean componentSpecified,
            ActivityRecord[] outActivity, ActivityStackSupervisor.ActivityContainer container,
            TaskRecord inTask) {
    ...
    ProcessRecord callerApp = null;
    ...
    ActivityRecord sourceRecord = null;
    ActivityRecord resultRecord = null;
    ...
    ActivityRecord r = new ActivityRecord(mService, callerApp, callingUid, callingPackage,
            intent, resolvedType, aInfo, mService.mConfiguration, resultRecord, resultWho,
            requestCode, componentSpecified, voiceSession != null, mSupervisor, container,
            options, sourceRecord);
    ...
    err = startActivityUnchecked(r, sourceRecord, voiceSession, voiceInteractor, startFlags,
            true, options, inTask);
    ...
    return err;
}

private int startActivityUnchecked(final ActivityRecord r, ActivityRecord sourceRecord,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
            int startFlags, boolean doResume, ActivityOptions options, TaskRecord inTask) {
    setInitialState(r, options, inTask, doResume, startFlags, sourceRecord, voiceSession,
    voiceInteractor);
    computeLaunchingTaskFlags();
    ...
    mIntent.setFlags(mLaunchFlags);
    mReusedActivity = getReusableIntentActivity();
    ...
    boolean newTask = false;
    ...
     if (mStartActivity.resultTo == null &amp;&amp; mInTask == null &amp;&amp; !mAddingToTask
        &amp;&amp; (mLaunchFlags &amp; FLAG_ACTIVITY_NEW_TASK) != 0) {
        newTask = true;
        ...
    }
    ...
    mTargetStack.startActivityLocked(mStartActivity, newTask, mKeepCurTransition, mOptions);
    ...
    mSupervisor.resumeFocusedStackTopActivityLocked(mTargetStack, mStartActivity,
                        mOptions);
    ...
}

先看setInitialState方法
private void setInitialState(ActivityRecord r, ActivityOptions options, TaskRecord inTask,
            boolean doResume, int startFlags, ActivityRecord sourceRecord,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor) {
    reset();
    mStartActivity = r;
    mIntent = r.intent;
    mOptions = options;
    mCallingUid = r.launchedFromUid;
    mSourceRecord = sourceRecord;
    mVoiceSession = voiceSession;
    ...
    mLaunchSingleTop = r.launchMode == LAUNCH_SINGLE_TOP;
    mLaunchSingleInstance = r.launchMode == LAUNCH_SINGLE_INSTANCE;
    mLaunchSingleTask = r.launchMode == LAUNCH_SINGLE_TASK;
    mLaunchFlags = adjustLaunchFlagsToDocumentMode(
            r, mLaunchSingleInstance, mLaunchSingleTask, mIntent.getFlags());
     ...
}
这里初始化了一些Activity的基本元素

之后computeLaunchingTaskFlags方法初始化启动标志位
然后mIntent.setFlags(mLaunchFlags);

final void startActivityLocked(ActivityRecord r, boolean newTask, boolean keepCurTransition,
            ActivityOptions options) {
    ...
    mWindowManager.setAppVisibility(r.appToken, true);
    // 表示这个Activity已经具备了显示的条件
    ...
}

接下来我们会调用ActivityStackSupervisor的resumeFocusedStackTopActivityLocked方法
，接着调ActivityStack的resumeTopActivityUncheckedLocked方法
，再调自己的resumeTopActivityInnerLocked方法
，如果Activity已存在需要可见状态，那么会调IApplicationThread的scheduleResumeActivity方法，
且经过一系列判断可见Activity；反之调ActivityStackSupervisor的startSpecificActivityLocked的方法
，那么继续会调realStartActivityLocked的方</code></pre><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/c27a8e9f-547a-4932-a3ec-7609ad1a8dd9/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45BGMYQT6J%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T020052Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCrlLN7wsv%2BTC1H3UhT2BWXLEbIFu84YlFPSEULO8tGbAIgJw5hAh%2BmD9q8CF1q0dUBYYmy7fLGybiFXUaNVp%2BvTCkqtAMIZhAAGgwyNzQ1NjcxNDkzNzAiDGzyGx4ScYOs4BsygCqRAzSxMViZG1aYRupqqXqwsehKxhOzJ1cIPF2pVUBCzxG4GY3Za2q98YdxXRf0aygK33EHCbPDjETBi%2Ff1eYRQwAqy6DgRS2l9Na5PbuGhUpGZjh08R01AkpFpTqvR%2FKikfu95U%2BXG1has3Xlcg1w5B33Doo%2FJ0Ca8dyPysePbsocyzNz2FyQvCCR%2Fv5AHfsBd4znRjcl%2B4fXUp%2F4eyV56aPlehcGGs1diCgajGQ6PCUnWqbJo9opdHHgCA8mgfx0u9A%2FqAZWJBxGVwtJK9oOMVXzntiREOCpTiANHqRn%2B8hM3Yy3SyI0M64cJzp%2FF%2BIwhyYymQDlcb%2Bo189YvDMoy8I5h9a%2FUrFgGouoLvh2OP12FdCfJna8zOsmc6UdLAPR9xiAWPab52U0zRzcrEiRx%2B0mRkJ9aabwz5kBiNluK4zIzkGUpJaFx4veso1BvYwomz1VIsbnNMbdA4vxrd5eSlQFzBd815W3jG7aOvkw1iF%2Boa2RL9%2BZM9bDRKiMn7IPLccZTMGH0Jq8AlLsxWZ9qWz4CMNjR%2BPAFOusBI026Ni36%2B6ttH9x1r8%2FqzqZj%2Fd4emkhfJVH5zz2n5AOs2hTLWzNFLbHPfEmhc3W3zjuBqzh6YUf7brdvomFBVhGwK54MCSuP1PRe8jv8sIzTZgGQBTHFxzstTEyNB7T%2FuGwfyZedjjZBayBE4DY4cwEohKi5e%2BVFBMCKuabPKNhwWXsUUkchj3OQESh%2BDwqm75e3dbJAY71oI9GIAg%2F0LIVbhiidOasztq8OA34Zf20xmgdybl28sJQ28%2F5ujHW%2FMc%2BOJzqO66Oy4H7UKNMQEzMpALMNI7P7VFLZIG17aq0LEQ%2BWRpBAwk5WtQ%3D%3D&X-Amz-Signature=297f114c8203811b5b82c8d3456a66730952383c322a493ed346df610b634452&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c27a8e9f-547a-4932-a3ec-7609ad1a8dd9/Untitled.png"></p>
<p>之后调用ApplicationThread的scheduleLaunchActivity方法啦！</p>
<pre><code>@Override
public final void scheduleLaunchActivity(Intent intent, IBinder token, int ident,
        ActivityInfo info, Configuration curConfig, Configuration overrideConfig,
        CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,
        int procState, Bundle state, PersistableBundle persistentState,
        List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents,
        boolean notResumed, boolean isForward, ProfilerInfo profilerInfo) {
    updateProcessState(procState, false);
    ActivityClientRecord r = new ActivityClientRecord();
    r.token = token;
    r.ident = ident;
    r.intent = intent;
    r.referrer = referrer;
    r.voiceInteractor = voiceInteractor;
    r.activityInfo = info;
    r.compatInfo = compatInfo;
    r.state = state;
    r.persistentState = persistentState;
    r.pendingResults = pendingResults;
    r.pendingIntents = pendingNewIntents;
    r.startsNotResumed = notResumed;
    r.isForward = isForward;
    r.profilerInfo = profilerInfo;
    r.overrideConfig = overrideConfig;
    updatePendingConfiguration(curConfig);
    sendMessage(H.LAUNCH_ACTIVITY, r);
}

在Handler中
private class H extends Handler {
    ...
    public void handleMessage(Message msg) {
        if (DEBUG_MESSAGES) Slog.v(TAG, &quot;&gt;&gt;&gt; handling: &quot; + codeToString(msg.what));
        switch (msg.what) {
            case LAUNCH_ACTIVITY: {
                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;activityStart&quot;);
                final ActivityClientRecord r = (ActivityClientRecord) msg.obj;
                r.packageInfo = getPackageInfoNoCheck(
                        r.activityInfo.applicationInfo, r.compatInfo);
                handleLaunchActivity(r, null, &quot;LAUNCH_ACTIVITY&quot;);
                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
            } break;
            ...
    }
}

调用handleLaunchActivity
ActivityThread.java
private void handleLaunchActivity(){
...
WindowManagerGlobal.initialize();//初始化WMS
Activity a = performLaunchActivity(r, customIntent);//创建并启动
....

private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {
    ActivityInfo aInfo = r.activityInfo;//取出组件信息，并一顿操作
    ...
    Activity activity = null;
    try {
        java.lang.ClassLoader cl = r.packageInfo.getClassLoader();
        activity = mInstrumentation.newActivity(
                cl, component.getClassName(), r.intent);
         //开始创建Activity实例，通过类加载器创建，看参数就知道了
         ...
         Application app = r.packageInfo.makeApplication(false, mInstrumentation);
         //获取Application
         ...
         activity.attach(appContext, this, getInstrumentation(), r.token,
                        r.ident, app, r.intent, r.activityInfo, title, r.parent,
                        r.embeddedID, r.lastNonConfigurationInstances, config,
                        r.referrer, r.voiceInteractor, window);
         //与window建立关联
         ...
         mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);
         //callActivityOnCreate-&gt;activity.performCreate-&gt;onCreate，之后就很熟悉了
         ...
    }
}

其中的makeApplication方法
public Application makeApplication(boolean forceDefaultAppClass,
            Instrumentation instrumentation) {
    if (mApplication != null) {
        return mApplication;
    }
    //如果mApplication不为空则直接返回，这也是为什么Application为单例
    ...
    Application app = null;
    ...
    ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);
    app = mActivityThread.mInstrumentation.newApplication(
                cl, appClass, appContext);
    //创建Application，跟Activity一样，都是用类加载器创建
    ...
    mApplication = app;//保存下来
    ...
    instrumentation.callApplicationOnCreate(app);
    //callApplicationOnCreate-&gt;onCreate
    ...
}</code></pre><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/eae3a6be-0576-4b97-ad77-a7b545e9d38d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45ABCNKXHH%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T020040Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD%2FHuUjg5gr8C7Ed13a4i1kJx6kZ5qxZMvnUPp5LlianwIhAJx4ni%2FL8n3AwZ7127oG8PSgHAPZ4WmQHNL%2FnbFxZOfnKrQDCGYQABoMMjc0NTY3MTQ5MzcwIgyYenibqLwYVL87r6IqkQOvsGK7n9vUVFwwatyrD2Qt3gyVB%2B2L3QFZPQzIexEz5YgDjKK0RYL0VmWKidxZqjUTwA4u275MgT1Mu9ZY2XGxD6er6X6QSeGUL%2BwcJPT8r0SaHPf3hmQsAL3o7w5v4UIND9NNpTwwGodMvqpDJn%2FgVExFYsig3Ol7Q3OPi2K3%2Bnp2KyQzwsacBoB%2Bs5KGvsRTQ3Ajb%2FWfQw5FRYOMrYc9Qa4Fag%2BeVjHtkBs9YdiFPXnc6d4VB4blHi6D9fWhzytljnrB1PiwviOmHPLSgVB2kHz1B%2BsnqVhc0uvFr4uV6Te7BF2rI%2FvonJzEYD6KmNV0pBnhDLsCxHUkRdIVTpmHRe%2FvdLYicmdk4UuERI7ypL1o2Aa5m2X4jG0hqYJDDYBT18SiVtz56MWzXlZN0qI2Wi3NtBr%2FHtqlevEbKLh8kZyco5x0ds1MBf4KoZWU9rYUhWEiplLZK0%2Fg0OYuygqmXn6YIeJRtuHzsriiomDpP4gqf1lJbehN5Sw9c2u%2F4Hc1y%2BqdClYhvUwlCSUlTbb%2BxTDy2vjwBTrqAZrstycL0LbjMiXqUGpuvlCAVxf8aDIqg5Ea6964D68HFl9Rqdivvv%2BxOhdoTN0b1v0g8uiDwUgw82pN3F3xJzE9VprK9rVw4KUIPw8xjqhbWVvrSjYV5NVc5clWKCDKE3mEkpgt5LAGrFTUkdmAHsS098AOQhvkF5Y%2BYZgkLIIlIzFAEa8UkVVmCwU%2FulzgNRAiLAvUtScW68HS1A%2BTp4YWXcvAQMU4h%2BINO5SKg1k2hgoU%2Fb8NPa6ofU6IFvJ5uwk3XPspesDedi86HlCTs1fLW%2BS%2F27UODic9Lhvn9Vta2lAa9Xpsn6OKnA%3D%3D&X-Amz-Signature=2a45fb6aa493dc656c9d912a578476c768730500e68f6eb89950a669e0eea725&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/eae3a6be-0576-4b97-ad77-a7b545e9d38d/Untitled.png"></p>
<p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/a604c5b5-b967-4759-8527-dba82b60032a/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAT73L2G45CVDBZQGM%2F20200115%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200115T020029Z&X-Amz-Expires=86400&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEN7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCPFUQ9eVBhVG%2FxqjNRO11arCOihCaAOE%2FIvHjyGqhw1wIhAKBFpsEOpIXmHAx8hyq5YW5hdQq30S%2F34MeIzr5%2BsNlZKrQDCGcQABoMMjc0NTY3MTQ5MzcwIgwkBRVtA6z13TC4Q7MqkQNgsIkQD3FmJggamt3NXPLMPqH9jRLatDGTtop1ay9WbPSTgBcYKFIjehnCQdkHleEAj6Q0HglEifrQHM3lSWUjwPfc6GJr%2BKfiZvefyoa3fipuPspQ%2BV9PGuwTC8HX9he3sFuFl%2BL3If3G1JpssuyPsnXQLCyIJAhI1gajARFR34zIeiVZOq4rXsQpr5jd7mkxbDvOxog81t8JD8IIhmXhYOmYwBuP3aG7B1HH6%2FgkJVRD69yln1MN2HYcn6wbDElEoKxqri5Om4YSbt6J9vHlVIQpRkjGCO5AG%2BB%2BKjEQqnS%2F93YIv1h%2FB7SIAwpNCAop6cz4TXsR59aT4den7Sr0GUhUK26Ofx8EPbCb33NiaWNZqBJYU47jV%2FT6CUAOV4V8BHRcHk%2BuWBQ91UTVWEeeqAphJQsDS8byl%2BV%2BLw9gz%2F0y3yO99zTVhMI4QTgcNKdYIdBjOc2NyMimJ2dqTcBNdTg1zWS0%2FM%2FtttWejbOLLxVM%2BYJAyFvInzUiruH87zCpNGN16F70PW1vTHBnNg9p7zCM5fjwBTrqAaSNk4ugdnmFqEEAoCokJlJyP28l078BGYTwI9mte7tTbKZImR6gEeBxV0R6i545NGTPXsF3RbzuJZQdQl9WkJrAVbQ5FE6I6GEslT%2FNzH%2BKTqllG98naywEH92CZNvhrPfas2SjhSZeCz5i4Ng71uSB6hNrIZwBVlxohMVGl564UhUJS5b%2F0H7PxerJ8lU10Ze%2BvCL0PyBPq%2Ftqg6ebM61TJ1HH9ZreFba2x84qxFbCut%2FleuxJtCa8rerOZhqdSQ7GcX9a3d%2FZcZxaxLt2H%2BF6dWtvE%2BKZsrLZoHTlKt9Eew8e8Fyak2tEOA%3D%3D&X-Amz-Signature=42f5fcf4aac3359a7b8bf3b227620b0b3eaf4f47d1e57311004782dea8469e7d&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a604c5b5-b967-4759-8527-dba82b60032a/Untitled.png"></p>
<p>Instrumentation是一个很重要的类，负责intent的分发，调用Activity的onCreate, 调用Activity的onResume, 在插件化中也有广泛的应用。</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechat.jpg" alt="ScorpioNeal WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="ScorpioNeal Alipay">
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/AndroidActivity/" rel="tag"># AndroidActivity</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/d2b4a3fc/" rel="next" title="Android-RecyclerView与ListView的区别">
                <i class="fa fa-chevron-left"></i> Android-RecyclerView与ListView的区别
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/a6157931/" rel="prev" title="Android 常见内存泄漏">
                Android 常见内存泄漏 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3610947468348159" data-ad-slot="7426383787"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ScorpioNeal</p>
              <p class="site-description motion-element" itemprop="description">体系(点 - 线 - 面)</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">246</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#App启动过程"><span class="nav-number">1.</span> <span class="nav-text">App启动过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zygote"><span class="nav-number">2.</span> <span class="nav-text">Zygote</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#system-server"><span class="nav-number">3.</span> <span class="nav-text">system_server</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ScorpioNeal</span>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>



        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'Bp6gNEmnfgAF2Ci7moO9v4Rm-gzGzoHsz',
        appKey: 'xNstrbz0DRkVzIMvuDNrkAOh',
        placeholder: '要不要说点啥',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  <script type="text/javascript" src="/js/src/dynamic_bg.js"></script>
  <script type="text/javascript" src="/js/src/love-click.js"></script>
</body>
</html>
